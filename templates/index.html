<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Photobooth Clovers</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.socket.io/4.7.4/socket.io.min.js" crossorigin="anonymous"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --green: #2e7d32;
      --green-dark: #256428;
      --bg: #f5f9f6;
      --text: #1a4d2e;
      --muted: #9aa7a0;
      --badge-pending-bg: #ffecb3;
      --badge-pending-text: #8a6d00;
      --badge-done-bg: #4a7a44;
      --badge-done-text: #fff;
    }
    body { font-family:'Inter',sans-serif; background:var(--bg); margin:0; padding:2rem; color:var(--text);}
    .container { max-width:1000px; margin:auto; background:#fff; border-radius:16px; padding:2rem; box-shadow:0 6px 20px rgba(0,0,0,0.1);}
    h1 { margin-bottom:1rem; text-align:center;}
    .btn {border:none; border-radius:12px; padding:0.7rem 1.2rem; font-weight:600; cursor:pointer; transition:0.2s; background:var(--green); color:#fff; text-decoration:none;}
    .btn:hover { background:var(--green-dark);}
    .btn-secondary { background:#f0f3f1; color:var(--text);}
    .btn-secondary:hover { background:#e8eeea;}
    table { width:100%; border-collapse:collapse; margin-top:1rem;}
    th,td { text-align:left; padding:0.75rem;}
    th { background:#e6f5ec;}
    tr:nth-child(even) { background:#f9f9f9;}
    .badge { padding:0.25rem 0.6rem; border-radius:12px; font-weight:600; font-size:0.85rem;}
    .badge.pending { background:var(--badge-pending-bg); color:var(--badge-pending-text);}
    .badge.done { background:var(--badge-done-bg); color:var(--badge-done-text);}
    .top-actions { display:flex; gap:0.5rem; justify-content:center; margin-top:1rem; flex-wrap:wrap;}
  </style>
</head>
<body>
<div class="container">

  {% if page == 'form' %}
    <h1>üì∏ Photobooth Clovers ‚Äî Order Form</h1>
    <form action="{{ url_for('submit') }}" method="POST" autocomplete="off">
      <input type="text" name="name" placeholder="Name" required>
      <input type="email" name="email" placeholder="Email (optional)">
      <input type="number" name="copies" placeholder="Number of Copies" required min="1">
      <input type="number" name="amount" placeholder="Amount Paid" required min="0">
      <button type="submit" class="btn">Submit</button>
    </form>
    <div class="top-actions">
      <a href="{{ url_for('queue') }}" class="btn btn-secondary">üîé View Live Queue</a>
      <a href="{{ url_for('admin') }}" class="btn btn-secondary">üõ† Admin</a>
    </div>

  {% elif page == 'thanks' %}
    <h1>‚úÖ Order Submitted!</h1>
    <p style="text-align:center;">üéüÔ∏è Your queue number: <b>#{{ position }}</b></p>
    <div class="top-actions">
      <a href="{{ url_for('queue') }}" class="btn">Go to Live Queue</a>
      <a href="{{ url_for('form') }}" class="btn btn-secondary">Submit Another</a>
    </div>

  {% elif page == 'queue' %}
    <h1>üìã Live Queue</h1>
    <table>
      <thead><tr><th>#</th><th>Name</th><th>Copies</th><th>Amount</th><th>Status</th></tr></thead>
      <tbody>
        {% for r in orders %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>{{ r["Name"] }}</td>
            <td>{{ r["Copies"] }}</td>
            <td>{{ r["Amount Paid"] }}</td>
            <td><span class="badge pending">Pending</span></td>
          </tr>
        {% endfor %}
        {% if orders|length == 0 %}
          <tr><td colspan="5" style="color:var(--muted);">No pending orders right now.</td></tr>
        {% endif %}
      </tbody>
    </table>
    <div class="top-actions">
      <a href="{{ url_for('form') }}" class="btn btn-secondary">‚¨Ö Back to Form</a>
    </div>

  {% elif page == 'login' %}
    <h1>üîë Admin Login</h1>
    <form method="POST">
      <input type="password" name="password" placeholder="Admin Password" required>
      <button type="submit" class="btn">Login</button>
    </form>
    {% if error %}<p style="color:#b00020">{{ error }}</p>{% endif %}

  {% elif page == 'admin' %}
    <h1>üõ† Admin Dashboard</h1>
    <div class="top-actions">
      <a href="{{ url_for('logout') }}" class="btn btn-secondary">Logout</a>
      <a href="{{ url_for('queue') }}" class="btn btn-secondary">View Queue</a>
    </div>
    <table>
      <thead>
        <tr><th>#</th><th>Name</th><th>Email</th><th>Copies</th><th>Amount</th><th>Status</th><th>Updated</th><th>Action</th></tr>
      </thead>
      <tbody>
        {% for r in orders %}
          <tr>
            <td>{{ r["ID"] }}</td>
            <td>{{ r["Name"] }}</td>
            <td>{{ r["Email"] }}</td>
            <td>{{ r["Copies"] }}</td>
            <td>{{ r["Amount Paid"] }}</td>
            <td><span class="badge {{ 'pending' if r['Status']=='Pending' else 'done' }}">{{ r["Status"] }}</span></td>
            <td>{{ r["Timestamp"] }}</td>
            <td>
              <form method="POST" action="{{ url_for('toggle', order_id=r['ID']) }}">
                <button class="btn" type="submit">
                  {% if r["Status"] == "Pending" %}Mark Done{% else %}Undo{% endif %}
                </button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endif %}
</div>

<script>
  const socket = io();
  socket.on("orders_updated", () => {
    const path = window.location.pathname;
    if (path === "/queue" || path === "/admin") {
      window.location.reload();
    }
  });
</script>
</body>
</html>
