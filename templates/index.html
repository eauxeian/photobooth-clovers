<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ğŸ€ Photobooth Clovers</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>

<style>
body { font-family: sans-serif; background:#f9f9f9; padding:1rem }
.container { background:#fff; padding:1.5rem; border-radius:12px; max-width:1000px; margin:auto }
table { width:100%; border-collapse:collapse; margin-top:1rem }
th, td { border:1px solid #ddd; padding:.5rem }
.badge.pending { background:#ffecb3; padding:.3rem .6rem; border-radius:6px }
.badge.done { background:#4a7a44; color:#fff; padding:.3rem .6rem; border-radius:6px }
button { padding:.4rem .7rem; margin:.1rem }
</style>
</head>

<body>
<div class="container">

{% if page == "form" %}
<h1>ğŸ“¸ Order Form</h1>
<form method="POST" action="/submit" onsubmit="timestamp.value=new Date().toISOString().slice(0,19).replace('T',' ')">
<input name="name" required placeholder="Name">
<input name="email" placeholder="Email">
<input name="copies" type="number" min="1" required>
<input name="amount" type="number" min="0" required>
<input type="hidden" name="timestamp">
<button>Submit</button>
</form>
<a href="/queue">View Queue</a> | <a href="/admin">Admin</a>

{% elif page == "thanks" %}
<h1>âœ… Submitted</h1>
<p>Your position: <b>#{{ position }}</b></p>
<a href="/queue">Queue</a>

{% elif page == "queue" %}
<h1>ğŸ“‹ Live Queue</h1>
<table>
<thead><tr><th>#</th><th>Name</th><th>Copies</th><th>Amount</th></tr></thead>
<tbody id="queue-body"></tbody>
</table>

{% elif page == "login" %}
<h1>ğŸ”‘ Admin Login</h1>
<form method="POST">
<input type="password" name="password">
<button>Login</button>
</form>
{{ error }}

{% elif page == "admin" %}
<h1>ğŸ›  Admin Dashboard</h1>
<a href="/logout">Logout</a>

<table>
<thead>
<tr>
<th>ID</th><th>Name</th><th>Copies</th><th>Amount</th>
<th>Status</th><th>Printed</th><th>Claimed</th><th>Actions</th>
</tr>
</thead>
<tbody id="admin-body"></tbody>
</table>
{% endif %}

</div>

<script>
const socket = io();

socket.on("queue_update", data => {

  if (location.pathname === "/queue") {
    const tbody = document.getElementById("queue-body");
    tbody.innerHTML = "";
    data.pending.forEach((o,i) => {
      tbody.innerHTML += `<tr>
        <td>${i+1}</td>
        <td>${o.Name}</td>
        <td>${o.Copies}</td>
        <td>${o["Amount Paid"]}</td>
      </tr>`;
    });
  }

  if (location.pathname === "/dashboard") {
    const tbody = document.getElementById("admin-body");
    tbody.innerHTML = "";
    data.all.forEach(o => {
      tbody.innerHTML += `<tr>
        <td>${o.ID}</td>
        <td>${o.Name}</td>
        <td>${o.Copies}</td>
        <td>${o["Amount Paid"]}</td>
        <td><span class="badge ${o.Status==="Pending"?"pending":"done"}">${o.Status}</span></td>
        <td>${o.Printed}</td>
        <td>${o.Claimed}</td>
        <td>
          <form method="POST" action="/toggle/${o.ID}"><button>Done/Undo</button></form>
          <form method="POST" action="/toggle_printed/${o.ID}"><button>Printed</button></form>
          <form method="POST" action="/toggle_claimed/${o.ID}"><button>Claimed</button></form>
        </td>
      </tr>`;
    });
  }
});
</script>

</body>
</html>
